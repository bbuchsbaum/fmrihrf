# fmrihrf

Hemodynamic response functions and event-related regressors for fMRI
analysis in R.

**fmrihrf** provides a composable toolkit for constructing, modifying,
and convolving HRFs with experimental designs. It ships with standard
basis sets (SPM canonical, B-spline, Fourier, FIR, Gamma, Gaussian, and
more), decorators for time-shifting and blocking, and a fast C++
convolution backend.

## Installation

``` r
# From CRAN
install.packages("fmrihrf")

# Development version
remotes::install_github("bbuchsbaum/fmrihrf")
```

## Quick start

``` r
library(fmrihrf)

# Evaluate the SPM canonical HRF over 0-30 seconds
t <- seq(0, 30, by = 0.1)
y <- evaluate(HRF_SPMG1, t)
plot(t, y, type = "l", xlab = "Time (s)", ylab = "Response")

# Build a regressor from event onsets
reg <- regressor(onsets = c(2, 10, 18), hrf = HRF_SPMG1,
                 duration = 0, amplitude = 1,
                 span = 24, sampling_frame = sampling_frame(blocklens = 100, TR = 1))
plot(reg)
```

## Key features

**Multiple basis sets** — Use a single canonical HRF or a flexible basis
set to capture response variability.

``` r
HRF_SPMG1                                    # SPM canonical (double gamma)
HRF_SPMG3                                    # canonical + temporal & dispersion derivatives
hrf_bspline(t, N = 6)                        # B-spline basis
hrf_fourier(t, N = 5)                        # Fourier basis
```

**Decorators** — Modify any HRF through functional composition.

``` r
lag_hrf(HRF_SPMG1, lag = 2)                  # shift peak by 2 s
block_hrf(HRF_SPMG1, width = 15)             # sustained/blocked response
normalise_hrf(HRF_SPMG1)                     # unit peak-normalised
```

**Custom HRFs** — Wrap any `f(t)` into the HRF system.

``` r
my_hrf <- as_hrf(function(t) exp(-t / 5), name = "exponential", span = 20)
evaluate(my_hrf, seq(0, 20, by = 1))
```

**Regressor construction** — Convolve events with HRFs to produce
design-matrix columns, with support for variable durations, amplitudes,
and multi-basis expansion.

``` r
sf <- sampling_frame(blocklens = c(200, 200), TR = 2)
reg <- regressor(onsets = c(10, 30, 50), hrf = HRF_SPMG1,
                 duration = c(0, 5, 0), amplitude = c(1, 1.5, 1),
                 sampling_frame = sf)
evaluate(reg)
```

**Fast convolution** — Core routines are implemented in C++ (Rcpp /
RcppArmadillo) for efficient large-scale design matrix generation.

## Documentation

Full documentation is available at
<https://bbuchsbaum.github.io/fmrihrf/>.

Vignettes cover the main workflows:

- [Hemodynamic Response
  Functions](https://bbuchsbaum.github.io/fmrihrf/articles/a_01_hemodynamic_response.html)
  — overview of built-in HRFs and the basis-set system
- [Building
  Regressors](https://bbuchsbaum.github.io/fmrihrf/articles/a_02_regressor.html)
  — constructing design-matrix regressors from event timing
- [HRF
  Generators](https://bbuchsbaum.github.io/fmrihrf/articles/a_03_hrf_generators.html)
  — programmatically generating families of HRFs
- [Advanced Modeling and
  Design](https://bbuchsbaum.github.io/fmrihrf/articles/a_04_advanced_modeling.html)
  — multi-basis designs, trial-varying HRFs, and more

## License

MIT

# Package index

## All functions

- [`HRF()`](https://bbuchsbaum.github.io/fmrihrf/reference/HRF-class.md)
  : HRF Constructor Function

- [`HRF_GAMMA()`](https://bbuchsbaum.github.io/fmrihrf/reference/HRF_objects.md)
  [`HRF_GAUSSIAN()`](https://bbuchsbaum.github.io/fmrihrf/reference/HRF_objects.md)
  [`HRF_SPMG1()`](https://bbuchsbaum.github.io/fmrihrf/reference/HRF_objects.md)
  [`HRF_SPMG2()`](https://bbuchsbaum.github.io/fmrihrf/reference/HRF_objects.md)
  [`HRF_SPMG3()`](https://bbuchsbaum.github.io/fmrihrf/reference/HRF_objects.md)
  [`HRF_BSPLINE()`](https://bbuchsbaum.github.io/fmrihrf/reference/HRF_objects.md)
  [`HRF_FIR()`](https://bbuchsbaum.github.io/fmrihrf/reference/HRF_objects.md)
  : Pre-defined Hemodynamic Response Function Objects

- [`acquisition_onsets()`](https://bbuchsbaum.github.io/fmrihrf/reference/acquisition_onsets.md)
  : Get fMRI Acquisition Onset Times

- [`amplitudes()`](https://bbuchsbaum.github.io/fmrihrf/reference/amplitudes.md)
  : Get amplitudes from an object

- [`block_hrf()`](https://bbuchsbaum.github.io/fmrihrf/reference/block_hrf.md)
  : Create a Blocked HRF Object

- [`blockids()`](https://bbuchsbaum.github.io/fmrihrf/reference/blockids.md)
  : Get block identifiers

- [`blocklens()`](https://bbuchsbaum.github.io/fmrihrf/reference/blocklens.md)
  : Get block lengths

- [`deriv(`*`<HRF>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/deriv.HRF.md)
  : Default derivative method for HRF objects

- [`deriv()`](https://bbuchsbaum.github.io/fmrihrf/reference/deriv.md) :
  Compute derivatives of HRF functions

- [`deriv(`*`<SPMG1_HRF>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/deriv.SPMG1_HRF.md)
  : Derivative method for SPMG1 HRF

- [`deriv(`*`<SPMG2_HRF>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/deriv.SPMG2_HRF.md)
  : Derivative method for SPMG2 HRF

- [`deriv(`*`<SPMG3_HRF>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/deriv.SPMG3_HRF.md)
  : Derivative method for SPMG3 HRF

- [`durations()`](https://bbuchsbaum.github.io/fmrihrf/reference/durations.md)
  : Get durations of an object

- [`evaluate(`*`<HRF>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/evaluate.HRF.md)
  : Evaluate an HRF Object

- [`evaluate()`](https://bbuchsbaum.github.io/fmrihrf/reference/evaluate.md)
  : Evaluate a regressor object over a time grid

- [`gen_hrf()`](https://bbuchsbaum.github.io/fmrihrf/reference/gen_hrf.md)
  : Construct an HRF Instance using Decorators

- [`gen_hrf_blocked()`](https://bbuchsbaum.github.io/fmrihrf/reference/gen_hrf_blocked.md)
  [`hrf_blocked()`](https://bbuchsbaum.github.io/fmrihrf/reference/gen_hrf_blocked.md)
  : Generate a Blocked HRF Function

- [`gen_hrf_lagged()`](https://bbuchsbaum.github.io/fmrihrf/reference/gen_hrf_lagged.md)
  [`hrf_lagged()`](https://bbuchsbaum.github.io/fmrihrf/reference/gen_hrf_lagged.md)
  : Generate a Lagged HRF Function

- [`getHRF()`](https://bbuchsbaum.github.io/fmrihrf/reference/getHRF.md)
  : Get HRF by Name

- [`global_onsets()`](https://bbuchsbaum.github.io/fmrihrf/reference/global_onsets.md)
  : Convert onsets to global timing

- [`hrf_basis_lwu()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_basis_lwu.md)
  : LWU HRF Basis for Taylor Expansion

- [`hrf_boxcar()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_boxcar.md)
  : Boxcar HRF (No Hemodynamic Delay)

- [`hrf_bspline()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_bspline.md)
  : B-spline HRF (hemodynamic response function)

- [`hrf_bspline_generator()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_bspline_generator.md)
  : Create B-spline HRF Basis Set

- [`hrf_daguerre_generator()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_daguerre_generator.md)
  : Create Daguerre HRF Basis Set

- [`hrf_fir_generator()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_fir_generator.md)
  : Create FIR HRF Basis Set

- [`hrf_fourier()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_fourier.md)
  : Fourier basis for HRF modeling

- [`hrf_fourier_generator()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_fourier_generator.md)
  : Create Fourier HRF Basis Set

- [`hrf_from_coefficients()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_from_coefficients.md)
  : Combine HRF Basis with Coefficients

- [`hrf_gamma()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_gamma.md)
  : Gamma HRF (hemodynamic response function)

- [`hrf_gaussian()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_gaussian.md)
  : Gaussian HRF (hemodynamic response function)

- [`hrf_half_cosine()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_half_cosine.md)
  : Half-cosine HRF

- [`hrf_inv_logit()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_inv_logit.md)
  : hrf_inv_logit

- [`hrf_lwu()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_lwu.md)
  : Lag-Width-Undershoot (LWU) HRF

- [`hrf_mexhat()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_mexhat.md)
  : Mexican Hat HRF (hemodynamic response function)

- [`hrf_sine()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_sine.md)
  : hrf_sine

- [`hrf_spmg1()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_spmg1.md)
  : hrf_spmg1

- [`hrf_tent_generator()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_tent_generator.md)
  : Create Tent HRF Basis Set

- [`hrf_time()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_time.md)
  : HRF (hemodynamic response function) as a linear function of time

- [`hrf_toeplitz()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_toeplitz.md)
  : HRF Toeplitz Matrix

- [`hrf_weighted()`](https://bbuchsbaum.github.io/fmrihrf/reference/hrf_weighted.md)
  : Weighted HRF (No Hemodynamic Delay)

- [`lag_hrf()`](https://bbuchsbaum.github.io/fmrihrf/reference/lag_hrf.md)
  : Lag an HRF Object

- [`list_available_hrfs()`](https://bbuchsbaum.github.io/fmrihrf/reference/list_available_hrfs.md)
  : List all available hemodynamic response functions (HRFs)

- [`make_hrf()`](https://bbuchsbaum.github.io/fmrihrf/reference/make_hrf.md)
  : Create an HRF from a basis specification

- [`nbasis()`](https://bbuchsbaum.github.io/fmrihrf/reference/nbasis.md)
  : Number of basis functions

- [`neural_input()`](https://bbuchsbaum.github.io/fmrihrf/reference/neural_input.md)
  : Generate Neural Input Function from Event Timing

- [`normalise_hrf()`](https://bbuchsbaum.github.io/fmrihrf/reference/normalise_hrf.md)
  : Normalise an HRF Object

- [`onsets()`](https://bbuchsbaum.github.io/fmrihrf/reference/onsets.md)
  : Get event onsets from an object

- [`penalty_matrix()`](https://bbuchsbaum.github.io/fmrihrf/reference/penalty_matrix.md)
  : Generate penalty matrix for regularization

- [`plot(`*`<HRF>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/plot.HRF.md)
  : Plot an HRF Object

- [`plot(`*`<Reg>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/plot.Reg.md)
  : Plot a Regressor Object

- [`plot_hrfs()`](https://bbuchsbaum.github.io/fmrihrf/reference/plot_hrfs.md)
  : Compare Multiple HRF Functions

- [`plot_regressors()`](https://bbuchsbaum.github.io/fmrihrf/reference/plot_regressors.md)
  : Compare Multiple Regressor Objects

- [`print(`*`<HRF>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/print.HRF.md)
  : Print an HRF Object

- [`print(`*`<Reg>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/print.md)
  [`print(`*`<sampling_frame>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/print.md)
  : Print method for Reg objects

- [`reconstruction_matrix()`](https://bbuchsbaum.github.io/fmrihrf/reference/reconstruction_matrix.md)
  : Combine HRF Basis with Coefficients

- [`regressor()`](https://bbuchsbaum.github.io/fmrihrf/reference/regressor.md)
  : Construct a Regressor Object

- [`regressor_design()`](https://bbuchsbaum.github.io/fmrihrf/reference/regressor_design.md)
  : Build a Design Matrix from Block-wise Onsets

- [`regressor_set()`](https://bbuchsbaum.github.io/fmrihrf/reference/regressor_set.md)
  [`evaluate(`*`<RegSet>`*`)`](https://bbuchsbaum.github.io/fmrihrf/reference/regressor_set.md)
  : Construct a Regressor Set

- [`samples()`](https://bbuchsbaum.github.io/fmrihrf/reference/samples.md)
  : Get sample acquisition times

- [`sampling_frame()`](https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.md)
  :

  A `sampling_frame` describes the block structure and temporal sampling
  of an fMRI paradigm.

- [`shift()`](https://bbuchsbaum.github.io/fmrihrf/reference/shift.md) :
  Shift a time series object

- [`single_trial_regressor()`](https://bbuchsbaum.github.io/fmrihrf/reference/single_trial_regressor.md)
  : Create a single trial regressor

# Articles

### All vignettes

- [Hemodynamic Response
  Functions](https://bbuchsbaum.github.io/fmrihrf/articles/a_01_hemodynamic_response.md):
- [Building fMRI
  Regressors](https://bbuchsbaum.github.io/fmrihrf/articles/a_02_regressor.md):
- [HRF
  Generators](https://bbuchsbaum.github.io/fmrihrf/articles/a_03_hrf_generators.md):
- [Advanced HRF Modeling and
  Design](https://bbuchsbaum.github.io/fmrihrf/articles/a_04_advanced_modeling.md):
