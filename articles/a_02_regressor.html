<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Building fMRI Regressors • fmrihrf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Building fMRI Regressors">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmrihrf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a_01_hemodynamic_response.html">Hemodynamic Response Functions</a></li>
    <li><a class="dropdown-item" href="../articles/a_02_regressor.html">Building fMRI Regressors</a></li>
    <li><a class="dropdown-item" href="../articles/a_03_hrf_generators.html">HRF Generators</a></li>
    <li><a class="dropdown-item" href="../articles/a_04_advanced_modeling.html">Advanced HRF Modeling and Design</a></li>
    <li><a class="dropdown-item" href="../articles/performance_benchmark.html">Performance Benchmarks</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmrihrf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Building fMRI Regressors</h1>
                        <h4 data-toc-skip class="author">Bradley R.
Buchsbaum</h4>
            
            <h4 data-toc-skip class="date">2025-08-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmrihrf/blob/main/vignettes/a_02_regressor.Rmd" class="external-link"><code>vignettes/a_02_regressor.Rmd</code></a></small>
      <div class="d-none name"><code>a_02_regressor.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-what-is-a-regressor">Introduction: What is a Regressor?<a class="anchor" aria-label="anchor" href="#introduction-what-is-a-regressor"></a>
</h2>
<p>In fMRI analysis, a <strong>regressor</strong> (or predictor)
represents the expected BOLD signal timecourse associated with a
specific experimental condition or event type. It’s typically created by
convolving a series of event onsets (often represented as delta
functions or “sticks”) with a hemodynamic response function (HRF).</p>
<p><code>fmrihrf</code> provides the <code><a href="../reference/regressor.html">regressor()</a></code> function
to easily create these objects from event timings and an HRF. While
these regressor objects are often constructed automatically by modeling
functions in other packages, this vignette explores how to create and
manipulate them directly, offering finer control over the model
components.</p>
</div>
<div class="section level2">
<h2 id="basic-regressor-from-event-onsets">Basic Regressor from Event Onsets<a class="anchor" aria-label="anchor" href="#basic-regressor-from-event-onsets"></a>
</h2>
<p>Suppose we have a simple event-related fMRI design with stimuli
presented every 12 seconds. We want to model these events using the SPM
canonical HRF (<code>HRF_SPMG1</code>). The events are brief, so we
model them with a duration of 0 seconds (instantaneous).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define event onsets</span></span>
<span><span class="va">onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span> <span class="op">*</span> <span class="fl">12</span>, by <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the regressor object</span></span>
<span><span class="co"># Uses HRF_SPMG1 by default if no hrf is specified</span></span>
<span><span class="co"># Duration is 0 by default</span></span>
<span><span class="va">reg1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regressor.html">regressor</a></span><span class="op">(</span>onsets <span class="op">=</span> <span class="va">onsets</span>, hrf <span class="op">=</span> <span class="va">HRF_SPMG1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the regressor object to see its properties (uses new print.Reg method)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reg1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access components using helper functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0 12 24 36 48 60</span></span>
<span><span class="fu"><a href="../reference/nbasis.html">nbasis</a></span><span class="op">(</span><span class="va">reg1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="evaluating-and-plotting-a-regressor">Evaluating and Plotting a Regressor<a class="anchor" aria-label="anchor" href="#evaluating-and-plotting-a-regressor"></a>
</h2>
<p>A <code>regressor</code> object stores the event information but
doesn’t automatically compute the timecourse. To get the predicted BOLD
signal at specific time points (e.g., corresponding to scan acquisition
times), we use the <code><a href="../reference/evaluate.html">evaluate()</a></code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a time grid corresponding to scan times (e.g., TR=2s)</span></span>
<span><span class="va">TR</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">scan_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">140</span>, by <span class="op">=</span> <span class="va">TR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate the regressor at scan times</span></span>
<span><span class="va">predicted_bold</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">reg1</span>, <span class="va">scan_times</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the predicted timecourse using ggplot2</span></span>
<span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="va">scan_times</span>, Response <span class="op">=</span> <span class="va">predicted_bold</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg1</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Predicted BOLD Response (SPM HRF)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Response"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_02_regressor_files/figure-html/evaluate_plot_basic-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="varying-event-durations">Varying Event Durations<a class="anchor" aria-label="anchor" href="#varying-event-durations"></a>
</h2>
<p>Sometimes events have different durations. The <code>duration</code>
argument in <code><a href="../reference/regressor.html">regressor()</a></code> can take a vector matching the
length of <code>onsets</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example onsets and durations</span></span>
<span><span class="va">onsets_var_dur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span> <span class="op">*</span> <span class="fl">12</span>, length.out <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">durations_var</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">onsets_var_dur</span><span class="op">)</span> <span class="co"># Durations increase from 1s to 6s</span></span>
<span></span>
<span><span class="co"># Create regressor with varying durations</span></span>
<span><span class="va">reg_var_dur</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regressor.html">regressor</a></span><span class="op">(</span><span class="va">onsets_var_dur</span>, <span class="va">HRF_SPMG1</span>, duration <span class="op">=</span> <span class="va">durations_var</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reg_var_dur</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate and plot</span></span>
<span><span class="va">scan_times_dur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">onsets_var_dur</span><span class="op">)</span> <span class="op">+</span> <span class="fl">30</span>, by <span class="op">=</span> <span class="va">TR</span><span class="op">)</span></span>
<span><span class="va">pred_var_dur</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">reg_var_dur</span>, <span class="va">scan_times_dur</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_df_dur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="va">scan_times_dur</span>, Response <span class="op">=</span> <span class="va">pred_var_dur</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_dur</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_var_dur</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Regressor with Varying Event Durations"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Duration increases over time"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Response"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_02_regressor_files/figure-html/varying_duration-1.png" width="672"></p>
<div class="section level3">
<h3 id="duration-and-summation">Duration and Summation<a class="anchor" aria-label="anchor" href="#duration-and-summation"></a>
</h3>
<p>By default (<code>summate=TRUE</code>), the predicted response
accumulates if events overlap or have extended duration. Setting
<code>summate=FALSE</code> models saturation, where the response width
increases with duration, but the peak amplitude doesn’t necessarily.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create regressor with varying durations, summate=FALSE</span></span>
<span><span class="va">reg_var_dur_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regressor.html">regressor</a></span><span class="op">(</span><span class="va">onsets_var_dur</span>, <span class="va">HRF_SPMG1</span>, </span>
<span>                               duration <span class="op">=</span> <span class="va">durations_var</span>, summate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate and plot</span></span>
<span><span class="va">pred_var_dur_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">reg_var_dur_nosum</span>, <span class="va">scan_times_dur</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_df_dur_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="va">scan_times_dur</span>, Response <span class="op">=</span> <span class="va">pred_var_dur_nosum</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_dur_nosum</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_var_dur_nosum</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Regressor with Varying Durations (summate=FALSE)"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Models saturation, peak height may not increase with duration"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Response"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_02_regressor_files/figure-html/duration_no_summate-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="varying-event-amplitudes-parametric-modulation">Varying Event Amplitudes (Parametric Modulation)<a class="anchor" aria-label="anchor" href="#varying-event-amplitudes-parametric-modulation"></a>
</h2>
<p>We can model variations in event intensity or some associated
parameter by providing an <code>amplitude</code> vector. This creates a
<em>parametric regressor</em> where the height of the HRF for each event
is scaled by the corresponding amplitude value.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example onsets and amplitudes (e.g., representing task difficulty)</span></span>
<span><span class="va">onsets_amp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span> <span class="op">*</span> <span class="fl">12</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span><span class="va">amplitudes_raw</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">onsets_amp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># It's common practice to center the modulator</span></span>
<span><span class="va">amplitudes_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">amplitudes_raw</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the parametric regressor</span></span>
<span><span class="va">reg_amp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regressor.html">regressor</a></span><span class="op">(</span><span class="va">onsets_amp</span>, <span class="va">HRF_SPMG1</span>, amplitude <span class="op">=</span> <span class="va">amplitudes_scaled</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reg_amp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate and plot</span></span>
<span><span class="va">scan_times_amp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">onsets_amp</span><span class="op">)</span> <span class="op">+</span> <span class="fl">30</span>, by <span class="op">=</span> <span class="va">TR</span><span class="op">)</span></span>
<span><span class="va">pred_amp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">reg_amp</span>, <span class="va">scan_times_amp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_df_amp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="va">scan_times_amp</span>, Response <span class="op">=</span> <span class="va">pred_amp</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_amp</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_amp</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add points showing amplitude (scaled for visibility)</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_amp</span><span class="op">)</span>, Amplitude <span class="op">=</span> <span class="fu"><a href="../reference/amplitudes.html">amplitudes</a></span><span class="op">(</span><span class="va">reg_amp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Amplitude</span> <span class="op">*</span> <span class="fl">0.2</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Parametric Regressor with Varying Amplitude"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Amplitude (centered) increases over time"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Response"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_02_regressor_files/figure-html/parametric_modulation-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="combining-duration-and-amplitude-modulation">Combining Duration and Amplitude Modulation<a class="anchor" aria-label="anchor" href="#combining-duration-and-amplitude-modulation"></a>
</h2>
<p>You can provide both <code>duration</code> and <code>amplitude</code>
vectors to model events that vary in both aspects.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">onsets_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span> <span class="op">*</span> <span class="fl">12</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span><span class="va">amps_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">onsets_comb</span><span class="op">)</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">durs_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">onsets_comb</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reg_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regressor.html">regressor</a></span><span class="op">(</span><span class="va">onsets_comb</span>, <span class="va">HRF_SPMG1</span>, </span>
<span>                      amplitude <span class="op">=</span> <span class="va">amps_comb</span>, duration <span class="op">=</span> <span class="va">durs_comb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reg_comb</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate and plot</span></span>
<span><span class="va">scan_times_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">onsets_comb</span><span class="op">)</span> <span class="op">+</span> <span class="fl">30</span>, by <span class="op">=</span> <span class="va">TR</span><span class="op">)</span></span>
<span><span class="va">pred_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">reg_comb</span>, <span class="va">scan_times_comb</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_df_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="va">scan_times_comb</span>, Response <span class="op">=</span> <span class="va">pred_comb</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_comb</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_comb</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Regressor with Varying Duration and Amplitude"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Response"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_02_regressor_files/figure-html/duration_amplitude-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="regressors-with-hrf-basis-sets">Regressors with HRF Basis Sets<a class="anchor" aria-label="anchor" href="#regressors-with-hrf-basis-sets"></a>
</h2>
<p>If you use an HRF object with multiple basis functions (e.g.,
<code>HRF_SPMG3</code>, <code>HRF_BSPLINE</code>), the
<code>regressor</code> object will represent multiple timecourses, one
for each basis function. <code><a href="../reference/evaluate.html">evaluate()</a></code> will return a
matrix.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use a B-spline basis set</span></span>
<span><span class="va">onsets_basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span> <span class="op">*</span> <span class="fl">12</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span><span class="va">hrf_basis</span> <span class="op">&lt;-</span> <span class="va">HRF_BSPLINE</span> <span class="co"># Uses N=5 basis functions by default</span></span>
<span></span>
<span><span class="va">reg_basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regressor.html">regressor</a></span><span class="op">(</span><span class="va">onsets_basis</span>, <span class="va">hrf_basis</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reg_basis</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/nbasis.html">nbasis</a></span><span class="op">(</span><span class="va">reg_basis</span><span class="op">)</span> <span class="co"># Should be 5</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span></span>
<span><span class="co"># Evaluate - this returns a matrix</span></span>
<span><span class="va">scan_times_basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">onsets_basis</span><span class="op">)</span> <span class="op">+</span> <span class="fl">30</span>, by <span class="op">=</span> <span class="va">TR</span><span class="op">)</span></span>
<span><span class="va">pred_basis_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">reg_basis</span>, <span class="va">scan_times_basis</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pred_basis_matrix</span><span class="op">)</span> <span class="co"># rows = time points, cols = basis functions</span></span>
<span><span class="co">#&gt; [1] 76  5</span></span>
<span></span>
<span><span class="co"># Or plot manually with ggplot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pred_basis_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Basis_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">pred_basis_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot_df_basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pred_basis_matrix</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Time <span class="op">=</span> <span class="va">scan_times_basis</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Basis"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_basis</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">Basis</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_basis</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Regressor using B-Spline Basis Set (N=5)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Response"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Basis Function"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_02_regressor_files/figure-html/basis_set_regressor-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="shifting-regressors">Shifting Regressors<a class="anchor" aria-label="anchor" href="#shifting-regressors"></a>
</h2>
<p>You can temporally shift all onsets within a regressor using the
<code><a href="../reference/shift.html">shift()</a></code> method.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Original regressor</span></span>
<span><span class="va">reg_orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regressor.html">regressor</a></span><span class="op">(</span>onsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">50</span><span class="op">)</span>, hrf <span class="op">=</span> <span class="va">HRF_SPMG1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Shifted regressor (delay by 5 seconds)</span></span>
<span><span class="va">reg_shifted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/shift.html">shift</a></span><span class="op">(</span><span class="va">reg_orig</span>, shift_amount <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_orig</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10 30 50</span></span>
<span><span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_shifted</span><span class="op">)</span> <span class="co"># Onsets are now 15, 35, 55</span></span>
<span><span class="co">#&gt; [1] 15 35 55</span></span>
<span></span>
<span><span class="co"># Plot both</span></span>
<span><span class="va">scan_times_shift</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, by <span class="op">=</span> <span class="va">TR</span><span class="op">)</span></span>
<span><span class="va">pred_orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">reg_orig</span>, <span class="va">scan_times_shift</span><span class="op">)</span></span>
<span><span class="va">pred_shifted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">reg_shifted</span>, <span class="va">scan_times_shift</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_df_shift</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Time <span class="op">=</span> <span class="va">scan_times_shift</span>,</span>
<span>  Original <span class="op">=</span> <span class="va">pred_orig</span>,</span>
<span>  Shifted_p5s <span class="op">=</span> <span class="va">pred_shifted</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Regressor"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_shift</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">Regressor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_orig</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="../reference/onsets.html">onsets</a></span><span class="op">(</span><span class="va">reg_shifted</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Shifting a Regressor"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Original (red lines) vs. Shifted +5s (blue lines)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Response"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_02_regressor_files/figure-html/shift_regressor-1.png" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
