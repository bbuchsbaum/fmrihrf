<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hemodynamic Response Functions • fmrihrf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hemodynamic Response Functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmrihrf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a_01_hemodynamic_response.html">Hemodynamic Response Functions</a></li>
    <li><a class="dropdown-item" href="../articles/a_02_regressor.html">Building fMRI Regressors</a></li>
    <li><a class="dropdown-item" href="../articles/a_03_hrf_generators.html">HRF Generators</a></li>
    <li><a class="dropdown-item" href="../articles/a_04_advanced_modeling.html">Advanced HRF Modeling and Design</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hemodynamic Response Functions</h1>
                        <h4 data-toc-skip class="author">Bradley R.
Buchsbaum</h4>
            
            <h4 data-toc-skip class="date">2025-06-07</h4>
      

      <div class="d-none name"><code>a_01_hemodynamic_response.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-hemodynamic-response-functions-hrfs">Introduction to Hemodynamic Response Functions (HRFs)<a class="anchor" aria-label="anchor" href="#introduction-to-hemodynamic-response-functions-hrfs"></a>
</h2>
<p>A hemodynamic response function (HRF) models the temporal evolution
of the fMRI BOLD (Blood-Oxygen-Level-Dependent) signal in response to a
brief neural event. Typically, the BOLD signal peaks 4-6 seconds after
the event onset and then returns to baseline, often with a slight
undershoot.</p>
<p><code>fmrihrf</code> provides tools to define, manipulate, and
visualize various HRFs commonly used in fMRI analysis.</p>
</div>
<div class="section level2">
<h2 id="pre-defined-hrf-objects">Pre-defined HRF Objects<a class="anchor" aria-label="anchor" href="#pre-defined-hrf-objects"></a>
</h2>
<p><code>fmrihrf</code> includes several pre-defined HRF objects, which
are essentially functions with specific attributes defining their type,
number of basis functions (<code>nbasis</code>), and effective duration
(<code>span</code>).</p>
<p>Let’s look at two common examples: the SPM canonical HRF
(<code>HRF_SPMG1</code>) and a Gaussian HRF
(<code>HRF_GAUSSIAN</code>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SPM canonical HRF (based on difference of two gamma functions)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t, P1 = 5, P2 = 15, A1 = 0.0833) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     ifelse(t &lt; 0, 0, exp(-t) * (A1 * t^P1 - 1.274527e-13 * t^P2))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1abaf4220&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:fmrihrf&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "SPMG1"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"param_names")</span></span>
<span><span class="co">#&gt; [1] "P1" "P2" "A1"</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; attr(,"params")$P1</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"params")$P2</span></span>
<span><span class="co">#&gt; [1] 15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"params")$A1</span></span>
<span><span class="co">#&gt; [1] 0.0833</span></span>
<span></span>
<span><span class="co"># Gaussian HRF</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">HRF_GAUSSIAN</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t, mean = 6, sd = 2) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     stats::dnorm(t, mean = mean, sd = sd)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1abb365b0&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:fmrihrf&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "gaussian"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"param_names")</span></span>
<span><span class="co">#&gt; [1] "mean" "sd"  </span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; attr(,"params")$mean</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"params")$sd</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>These objects are functions themselves, so you can evaluate them at
specific time points:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate the HRFs</span></span>
<span><span class="va">y_spm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HRF_objects.html">HRF_SPMG1</a></span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">y_gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HRF_objects.html">HRF_GAUSSIAN</a></span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Manually scale each to peak at 1.0 for easier shape comparison</span></span>
<span><span class="va">y_spm_scaled</span> <span class="op">&lt;-</span> <span class="va">y_spm</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y_spm</span><span class="op">)</span></span>
<span><span class="va">y_gauss_scaled</span> <span class="op">&lt;-</span> <span class="va">y_gauss</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y_gauss</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine into a data frame for plotting</span></span>
<span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Time <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>  SPM_Canonical <span class="op">=</span> <span class="va">y_spm_scaled</span>,</span>
<span>  Gaussian <span class="op">=</span> <span class="va">y_gauss_scaled</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"HRF_Type"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot using ggplot2</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">HRF_Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comparison of SPM Canonical and Gaussian HRFs"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"HRFs manually scaled to peak at 1.0 for comparison"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"BOLD Response (normalized)"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"HRF Type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/evaluate_basic_hrfs-1.png" width="672"></p>
<p>Note that the <code>span</code> attribute (e.g., 24 seconds)
indicates the approximate time window over which the HRF is
non-zero.</p>
</div>
<div class="section level2">
<h2 id="modifying-hrf-parameters-with-gen_hrf">Modifying HRF Parameters with <code>gen_hrf</code><a class="anchor" aria-label="anchor" href="#modifying-hrf-parameters-with-gen_hrf"></a>
</h2>
<p>The <code>gen_hrf</code> function is a flexible way to create new HRF
functions, often by modifying the parameters of existing ones.</p>
<p>For example, the <code>hrf_gaussian</code> function takes
<code>mean</code> and <code>sd</code> arguments. We can use
<code>gen_hrf</code> to create Gaussian HRFs with different peak times
(<code>mean</code>) and widths (<code>sd</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Gaussian HRFs with different parameters using gen_hrf</span></span>
<span><span class="co"># Note: hrf_gaussian is the underlying function, not the HRF object HRF_GAUSSIAN</span></span>
<span><span class="va">hrf_gauss_7_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gaussian</span>, mean <span class="op">=</span> <span class="fl">7</span>, sd <span class="op">=</span> <span class="fl">3</span>, name <span class="op">=</span> <span class="st">"Gaussian (Mean=7, SD=3)"</span><span class="op">)</span></span>
<span><span class="va">hrf_gauss_5_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gaussian</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"Gaussian (Mean=5, SD=2)"</span><span class="op">)</span></span>
<span><span class="va">hrf_gauss_4_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gaussian</span>, mean <span class="op">=</span> <span class="fl">4</span>, sd <span class="op">=</span> <span class="fl">1</span>, name <span class="op">=</span> <span class="st">"Gaussian (Mean=4, SD=1)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate the new HRFs</span></span>
<span><span class="va">vals1</span> <span class="op">&lt;-</span> <span class="fu">hrf_gauss_7_3</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">vals2</span> <span class="op">&lt;-</span> <span class="fu">hrf_gauss_5_2</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">vals3</span> <span class="op">&lt;-</span> <span class="fu">hrf_gauss_4_1</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine for plotting</span></span>
<span><span class="va">plot_df_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Time <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>  `Mean=7, SD=3` <span class="op">=</span> <span class="va">vals1</span>,</span>
<span>  `Mean=5, SD=2` <span class="op">=</span> <span class="va">vals2</span>,</span>
<span>  `Mean=4, SD=1` <span class="op">=</span> <span class="va">vals3</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Parameters"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_params</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">Parameters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Gaussian HRFs with Different Parameters"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Parameters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/modify_gaussian_params-1.png" width="672"></p>
<p><code>gen_hrf</code> can also directly incorporate lags and durations
(see later sections).</p>
</div>
<div class="section level2">
<h2 id="modeling-event-duration-with-block_hrf">Modeling Event Duration with <code>block_hrf</code><a class="anchor" aria-label="anchor" href="#modeling-event-duration-with-block_hrf"></a>
</h2>
<p>fMRI events often have a duration (e.g., a stimulus presented for
several seconds). The <code>block_hrf</code> function (or
<code>gen_hrf</code> with a <code>width</code> argument) modifies an HRF
to model the response to a sustained event of a specific
<code>width</code> (duration). Internally, it convolves the original HRF
with a boxcar function of the specified width.</p>
<p>The <code>precision</code> argument controls the sampling resolution
used for this convolution.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create blocked HRFs using the SPM canonical HRF with different durations</span></span>
<span><span class="va">hrf_spm_w1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate</span></span>
<span><span class="va">resp_w1</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w1</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_w2</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w2</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_w4</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w4</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine for plotting</span></span>
<span><span class="va">plot_df_blocked</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Time <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>  `Width=1s` <span class="op">=</span> <span class="va">resp_w1</span>,</span>
<span>  `Width=2s` <span class="op">=</span> <span class="va">resp_w2</span>,</span>
<span>  `Width=4s` <span class="op">=</span> <span class="va">resp_w4</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Duration"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_blocked</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">Duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SPM Canonical HRF for Different Event Durations"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Using block_hrf()"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Duration"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/blocked_hrfs-1.png" width="672"></p>
<div class="section level3">
<h3 id="normalization">Normalization<a class="anchor" aria-label="anchor" href="#normalization"></a>
</h3>
<p>By default, longer durations lead to higher peak responses (assuming
summation, see next section). Setting <code>normalize=TRUE</code> in
<code>block_hrf</code> (or <code>gen_hrf</code>) rescales the response
so the peak amplitude is approximately 1, regardless of duration.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create normalized blocked HRFs</span></span>
<span><span class="va">hrf_spm_w1_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">1</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w2_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">2</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w4_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">4</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate</span></span>
<span><span class="va">resp_w1_norm</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w1_norm</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_w2_norm</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w2_norm</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_w4_norm</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w4_norm</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine for plotting</span></span>
<span><span class="va">plot_df_blocked_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Time <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>  `Width=1s` <span class="op">=</span> <span class="va">resp_w1_norm</span>,</span>
<span>  `Width=2s` <span class="op">=</span> <span class="va">resp_w2_norm</span>,</span>
<span>  `Width=4s` <span class="op">=</span> <span class="va">resp_w4_norm</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Duration"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_blocked_norm</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">Duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Normalized SPM Canonical HRF for Different Durations"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Using block_hrf(normalize = TRUE)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Duration"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span> <span class="co"># Ensure y-axis starts at 0</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/blocked_normalized-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="modeling-saturation-with-summate">Modeling Saturation with <code>summate</code><a class="anchor" aria-label="anchor" href="#modeling-saturation-with-summate"></a>
</h3>
<p>The <code>summate</code> argument in <code>block_hrf</code> controls
whether the response accumulates over the duration
(<code>summate=TRUE</code>, default) or saturates
(<code>summate=FALSE</code>). Saturation implies that the response
reaches a plateau and doesn’t increase further with longer
stimulation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create non-summating blocked HRFs</span></span>
<span><span class="va">hrf_spm_w2_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">2</span>, summate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w4_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">4</span>, summate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w8_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">8</span>, summate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate</span></span>
<span><span class="va">resp_w2_nosum</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w2_nosum</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_w4_nosum</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w4_nosum</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_w8_nosum</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w8_nosum</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine for plotting</span></span>
<span><span class="va">plot_df_blocked_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Time <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>  `Width=2s` <span class="op">=</span> <span class="va">resp_w2_nosum</span>,</span>
<span>  `Width=4s` <span class="op">=</span> <span class="va">resp_w4_nosum</span>,</span>
<span>  `Width=8s` <span class="op">=</span> <span class="va">resp_w8_nosum</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Duration"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_blocked_nosum</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">Duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Non-Summating (Saturating) SPM HRF for Different Durations"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Using block_hrf(summate = FALSE)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Duration"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/blocked_summate_false-1.png" width="672"></p>
<p>We can combine <code>summate=FALSE</code> and
<code>normalize=TRUE</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create normalized, non-summating blocked HRFs</span></span>
<span><span class="va">hrf_spm_w2_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">2</span>, summate <span class="op">=</span> <span class="cn">FALSE</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w4_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">4</span>, summate <span class="op">=</span> <span class="cn">FALSE</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w8_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">8</span>, summate <span class="op">=</span> <span class="cn">FALSE</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate</span></span>
<span><span class="va">resp_w2_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w2_nosum_norm</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_w4_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w4_nosum_norm</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_w8_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu">hrf_spm_w8_nosum_norm</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine for plotting</span></span>
<span><span class="va">plot_df_blocked_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Time <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>  `Width=2s` <span class="op">=</span> <span class="va">resp_w2_nosum_norm</span>,</span>
<span>  `Width=4s` <span class="op">=</span> <span class="va">resp_w4_nosum_norm</span>,</span>
<span>  `Width=8s` <span class="op">=</span> <span class="va">resp_w8_nosum_norm</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Duration"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_blocked_nosum_norm</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">Duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Normalized, Non-Summating SPM HRF for Different Durations"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Using block_hrf(summate = FALSE, normalize = TRUE)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Duration"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/blocked_summate_false_norm-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="modeling-temporal-shifts-with-lag_hrf">Modeling Temporal Shifts with <code>lag_hrf</code><a class="anchor" aria-label="anchor" href="#modeling-temporal-shifts-with-lag_hrf"></a>
</h2>
<p>Sometimes, the hemodynamic response might be delayed or advanced
relative to the event onset. The <code>lag_hrf</code> function (or
<code>gen_hrf_lagged</code>) shifts an existing HRF in time by a
specified <code>lag</code> (in seconds). A positive lag delays the
response, while a negative lag advances it.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create lagged versions of the Gaussian HRF</span></span>
<span><span class="va">hrf_gauss_lag_neg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="va">HRF_GAUSSIAN</span>, lag <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">hrf_gauss_lag_0</span> <span class="op">&lt;-</span> <span class="va">HRF_GAUSSIAN</span> <span class="co"># Original (lag=0)</span></span>
<span><span class="va">hrf_gauss_lag_pos3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="va">HRF_GAUSSIAN</span>, lag <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate</span></span>
<span><span class="va">resp_lag_neg2</span> <span class="op">&lt;-</span> <span class="fu">hrf_gauss_lag_neg2</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_lag_0</span> <span class="op">&lt;-</span> <span class="fu">hrf_gauss_lag_0</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_lag_pos3</span> <span class="op">&lt;-</span> <span class="fu">hrf_gauss_lag_pos3</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine for plotting</span></span>
<span><span class="va">plot_df_lagged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Time <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>  `Lag=-2s` <span class="op">=</span> <span class="va">resp_lag_neg2</span>,</span>
<span>  `Lag= 0s` <span class="op">=</span> <span class="va">resp_lag_0</span>,</span>
<span>  `Lag=+3s` <span class="op">=</span> <span class="va">resp_lag_pos3</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Lag"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_lagged</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">Lag</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Gaussian HRF with Different Temporal Lags"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Using lag_hrf()"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Lag"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/lagged_hrfs-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="combining-lag-and-duration">Combining Lag and Duration<a class="anchor" aria-label="anchor" href="#combining-lag-and-duration"></a>
</h2>
<p>We can combine <code>lag_hrf</code> and <code>block_hrf</code> using
the pipe operator (<code>%&gt;%</code>) from <code>dplyr</code> (or
<code>magrittr</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create HRFs that are both lagged and blocked</span></span>
<span><span class="va">hrf_lb_1</span> <span class="op">&lt;-</span> <span class="va">HRF_GAUSSIAN</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_lb_3</span> <span class="op">&lt;-</span> <span class="va">HRF_GAUSSIAN</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">3</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_lb_5</span> <span class="op">&lt;-</span> <span class="va">HRF_GAUSSIAN</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">5</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate</span></span>
<span><span class="va">resp_lb_1</span> <span class="op">&lt;-</span> <span class="fu">hrf_lb_1</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_lb_3</span> <span class="op">&lt;-</span> <span class="fu">hrf_lb_3</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="va">resp_lb_5</span> <span class="op">&lt;-</span> <span class="fu">hrf_lb_5</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine for plotting</span></span>
<span><span class="va">plot_df_lagged_blocked</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Time <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>  `Lag=1, Width=1` <span class="op">=</span> <span class="va">resp_lb_1</span>,</span>
<span>  `Lag=3, Width=3` <span class="op">=</span> <span class="va">resp_lb_3</span>,</span>
<span>  `Lag=5, Width=5` <span class="op">=</span> <span class="va">resp_lb_5</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Settings"</span>, values_to <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_df_lagged_blocked</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Response</span>, color <span class="op">=</span> <span class="va">Settings</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Gaussian HRFs with Combined Lag and Duration"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Using lag_hrf() %&gt;% block_hrf()"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Settings"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/lagged_blocked_hrfs-1.png" width="672"></p>
<p>Alternatively, <code>gen_hrf</code> can apply lag and width
directly:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using gen_hrf directly</span></span>
<span><span class="va">hrf_lb_gen_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gaussian</span>, lag <span class="op">=</span> <span class="fl">3</span>, width <span class="op">=</span> <span class="fl">3</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">resp_lb_gen_3</span> <span class="op">&lt;-</span> <span class="fu">hrf_lb_gen_3</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare (should be very similar to hrf_lb_3 from piped version)</span></span>
<span><span class="co"># plot(time_points, resp_lb_3, type = 'l', col = 2, lwd = 2, main = "Piped vs gen_hrf")</span></span>
<span><span class="co"># lines(time_points, resp_lb_gen_3, col = 1, lty = 2, lwd = 2)</span></span>
<span><span class="co"># legend("topright", legend = c("Piped", "gen_hrf"), col = c(2, 1), lty = c(1, 2), lwd = 2)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multivariate-hrfs-basis-sets">Multivariate HRFs: Basis Sets<a class="anchor" aria-label="anchor" href="#multivariate-hrfs-basis-sets"></a>
</h2>
<p>Instead of assuming a fixed HRF shape, we can model the response
using a linear combination of multiple basis functions. This allows for
more flexibility in capturing variations in HRF shape across brain
regions or individuals. The resulting HRF function returns a matrix
where each column corresponds to a basis function.</p>
<div class="section level3">
<h3 id="spm-basis-sets">SPM Basis Sets<a class="anchor" aria-label="anchor" href="#spm-basis-sets"></a>
</h3>
<p><code>fmrihrf</code> provides pre-defined HRF objects for the SPM
canonical HRF plus its temporal derivative (<code>HRF_SPMG2</code>), and
additionally its dispersion derivative (<code>HRF_SPMG3</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SPM + Temporal Derivative (2 basis functions)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">HRF_SPMG2</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     do.call(cbind, lapply(xs, function(f) f(t)))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1a8ba6ec0&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1a8b9f8e8&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "SPMG2_HRF" "HRF"       "function" </span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "SPMG2"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="va">resp_spmg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HRF_objects.html">HRF_SPMG2</a></span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># SPM + Temporal + Dispersion Derivatives (3 basis functions)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">HRF_SPMG3</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     do.call(cbind, lapply(xs, function(f) f(t)))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1a8cdfe18&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1a8ccb3f0&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "SPMG3_HRF" "HRF"       "function" </span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "SPMG3"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="va">resp_spmg3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HRF_objects.html">HRF_SPMG3</a></span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot SPMG2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_spmg2</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"SPM + Temporal Derivative Basis Set (HRF_SPMG2)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Canonical"</span>, <span class="st">"Temporal Deriv."</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/spm_basis_sets-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot SPMG3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_spmg3</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"SPM + Temporal + Dispersion Derivative Basis Set (HRF_SPMG3)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Canonical"</span>, <span class="st">"Temporal Deriv."</span>, <span class="st">"Dispersion Deriv."</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/spm_basis_sets-2.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="b-spline-basis-set">B-Spline Basis Set<a class="anchor" aria-label="anchor" href="#b-spline-basis-set"></a>
</h3>
<p>The <code>hrf_bspline</code> function generates a B-spline basis set.
We typically use it within <code>gen_hrf</code> to create an HRF object.
Key parameters are <code>N</code> (number of basis functions) and
<code>degree</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># B-spline basis with N=5 basis functions, degree=3 (cubic)</span></span>
<span><span class="va">hrf_bs_5_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_bspline</span>, N <span class="op">=</span> <span class="fl">5</span>, degree <span class="op">=</span> <span class="fl">3</span>, name <span class="op">=</span> <span class="st">"B-spline (N=5, deg=3)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_bs_5_3</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; hrf(t, ...)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1ab3e4e80&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1a9a5f368&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "B-spline (N=5, deg=3)"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="va">resp_bs_5_3</span> <span class="op">&lt;-</span> <span class="fu">hrf_bs_5_3</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_bs_5_3</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"B-spline Basis Set (N=5, degree=3)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/bspline_basis-1.png" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># B-spline basis with N=10 basis functions, degree=1 (linear -&gt; tent functions)</span></span>
<span><span class="va">hrf_bs_10_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_bspline</span>, N <span class="op">=</span> <span class="fl">10</span>, degree <span class="op">=</span> <span class="fl">1</span>, name <span class="op">=</span> <span class="st">"Tent Set (N=10)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_bs_10_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; hrf(t, ...)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1ab3e4e80&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1a9e5d7b8&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "Tent Set (N=10)"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="va">resp_bs_10_1</span> <span class="op">&lt;-</span> <span class="fu">hrf_bs_10_1</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_bs_10_1</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Tent Function Basis Set (B-spline, N=10, degree=1)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/bspline_basis-2.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="sine-basis-set">Sine Basis Set<a class="anchor" aria-label="anchor" href="#sine-basis-set"></a>
</h3>
<p>The <code>hrf_sine</code> function creates a basis set using sine
waves of different frequencies.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrf_sin_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_sine</span>, N <span class="op">=</span> <span class="fl">5</span>, name <span class="op">=</span> <span class="st">"Sine Basis (N=5)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_sin_5</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; hrf(t, ...)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1ab3e4e80&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1aa4d43a8&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "Sine Basis (N=5)"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="va">resp_sin_5</span> <span class="op">&lt;-</span> <span class="fu">hrf_sin_5</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_sin_5</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Sine Basis Set (N=5)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/sine_basis-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="half-cosine-basis-set-flobs-like">Half-Cosine Basis Set (FLOBS-like)<a class="anchor" aria-label="anchor" href="#half-cosine-basis-set-flobs-like"></a>
</h3>
<p>The <code>hrf_half_cosine</code> function implements the basis set
described by Woolrich et al. (2004), often used in FSL’s FLOBS (FMRIB’s
Linear Optimal Basis Sets). It uses four half-cosine functions to model
initial dip, rise, fall/undershoot, and recovery.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use default parameters from Woolrich et al. (2004)</span></span>
<span><span class="co"># Note: hrf_half_cosine itself returns a single HRF shape, not a basis set directly.</span></span>
<span><span class="co"># To use as a basis in modeling, you'd typically include it alongside derivatives</span></span>
<span><span class="co"># or other basis functions. Here we just visualize the shape.</span></span>
<span><span class="va">resp_half_cos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_half_cosine.html">hrf_half_cosine</a></span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_half_cos</span>, type <span class="op">=</span> <span class="st">'l'</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Half-Cosine HRF Shape (Woolrich et al., 2004)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/half_cosine-1.png" width="672"></p>
<!-- ### Daguerre Polynomial Basis Set

Daguerre polynomials provide an orthogonal basis set on [0, ∞) suitable for modeling decaying responses. This functionality is not yet implemented in the package.


```` r
# Future implementation:
# hrf_dag_3 <- HRF_DAGUERRE_BASIS(n_basis = 3)
# print(hrf_dag_3)
# resp_dag_3 <- hrf_dag_3(time_points)
# matplot(time_points, resp_dag_3, type = 'l', lty = 1, lwd = 1.5,
#         xlab = "Time (seconds)", ylab = "BOLD Response",
#         main = "Daguerre Basis Set (N=3)")
``` -->
</div>
</div>
<div class="section level2">
<h2 id="other-hrf-shapes">Other HRF Shapes<a class="anchor" aria-label="anchor" href="#other-hrf-shapes"></a>
</h2>
<div class="section level3">
<h3 id="gamma-hrf">Gamma HRF<a class="anchor" aria-label="anchor" href="#gamma-hrf"></a>
</h3>
<p>The <code>hrf_gamma</code> function uses the gamma probability
density function.</p>
<p>````</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrf_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gamma</span>, shape <span class="op">=</span> <span class="fl">6</span>, rate <span class="op">=</span> <span class="fl">1</span>, name <span class="op">=</span> <span class="st">"Gamma (shape=6, rate=1)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_gam</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; hrf(t, ...)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1ab3e4e80&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1ab6c0068&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "Gamma (shape=6, rate=1)"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="va">resp_gam</span> <span class="op">&lt;-</span> <span class="fu">hrf_gam</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_gam</span>, type <span class="op">=</span> <span class="st">'l'</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Gamma HRF"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/gamma_hrf-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="mexican-hat-wavelet-hrf">Mexican Hat Wavelet HRF<a class="anchor" aria-label="anchor" href="#mexican-hat-wavelet-hrf"></a>
</h3>
<p>The <code>hrf_mexhat</code> function uses the Mexican hat wavelet
(second derivative of a Gaussian).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrf_mh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_mexhat</span>, mean <span class="op">=</span> <span class="fl">6</span>, sd <span class="op">=</span> <span class="fl">1.5</span>, name <span class="op">=</span> <span class="st">"Mexican Hat (mean=6, sd=1.5)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_mh</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; hrf(t, ...)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1ab3e4e80&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1abc07a68&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "Mexican Hat (mean=6, sd=1.5)"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="va">resp_mh</span> <span class="op">&lt;-</span> <span class="fu">hrf_mh</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_mh</span>, type <span class="op">=</span> <span class="st">'l'</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Mexican Hat Wavelet HRF"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/mexhat_hrf-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="inverse-logit-difference-hrf">Inverse Logit Difference HRF<a class="anchor" aria-label="anchor" href="#inverse-logit-difference-hrf"></a>
</h3>
<p>The <code>hrf_inv_logit</code> function creates an HRF shape by
subtracting two inverse logit (sigmoid) functions, allowing control over
rise and fall times.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrf_il</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_inv_logit</span>, mu1 <span class="op">=</span> <span class="fl">5</span>, s1 <span class="op">=</span> <span class="fl">1</span>, mu2 <span class="op">=</span> <span class="fl">15</span>, s2 <span class="op">=</span> <span class="fl">1.5</span>, name <span class="op">=</span> <span class="st">"Inv. Logit Diff."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_il</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; hrf(t, ...)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1ab3e4e80&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1a7293680&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "Inv. Logit Diff."</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="va">resp_il</span> <span class="op">&lt;-</span> <span class="fu">hrf_il</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_il</span>, type <span class="op">=</span> <span class="st">'l'</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Inverse Logit Difference HRF"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/inv_logit_hrf-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="creating-custom-basis-sets-with-gen_hrf_set">Creating Custom Basis Sets with <code>gen_hrf_set</code><a class="anchor" aria-label="anchor" href="#creating-custom-basis-sets-with-gen_hrf_set"></a>
</h2>
<p>The <code>gen_hrf_set</code> function allows you to combine
<em>any</em> set of HRF functions into a single multivariate HRF object
(a basis set).</p>
<p>For example, we can create a basis set from a series of lagged
Gaussian HRFs:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a list of lagged Gaussian HRFs</span></span>
<span><span class="va">lag_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">list_of_hrfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lag_times</span>, <span class="kw">function</span><span class="op">(</span><span class="va">lag</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="va">HRF_GAUSSIAN</span>, lag <span class="op">=</span> <span class="va">lag</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine them into a single HRF basis set object</span></span>
<span><span class="va">hrf_custom_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">gen_hrf_set</span>, <span class="va">list_of_hrfs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_custom_set</span><span class="op">)</span> <span class="co"># Note: name is default 'hrf_set', nbasis is 6</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     do.call(cbind, lapply(xs, function(f) f(t)))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1a8f32d18&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1a8f31ee0&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "hrf_set"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 34</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span></span>
<span><span class="co"># Evaluate and plot</span></span>
<span><span class="va">resp_custom_set</span> <span class="op">&lt;-</span> <span class="fu">hrf_custom_set</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">resp_custom_set</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Custom Basis Set (Lagged Gaussians)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/custom_basis_lagged-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="creating-empirical-hrfs">Creating Empirical HRFs<a class="anchor" aria-label="anchor" href="#creating-empirical-hrfs"></a>
</h2>
<div class="section level3">
<h3 id="from-a-single-measured-response-gen_empirical_hrf">From a Single Measured Response
(<code>gen_empirical_hrf</code>)<a class="anchor" aria-label="anchor" href="#from-a-single-measured-response-gen_empirical_hrf"></a>
</h3>
<p>If you have a measured or estimated hemodynamic response profile
(e.g., from deconvolution), you can turn it into an HRF function using
<code>gen_empirical_hrf</code>. It uses linear interpolation between the
provided points.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate an average measured response profile</span></span>
<span><span class="va">sim_times</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">24</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co"># For reproducibility</span></span>
<span><span class="va">sim_profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">20</span>, <span class="op">{</span></span>
<span>  <span class="va">h</span> <span class="op">&lt;-</span> <span class="va">HRF_SPMG1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                    <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">h</span><span class="op">(</span><span class="va">sim_times</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Normalize profile to max = 1 for better visualization</span></span>
<span><span class="va">sim_profile_norm</span> <span class="op">&lt;-</span> <span class="va">sim_profile</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sim_profile</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the empirical HRF function from the normalized profile</span></span>
<span><span class="va">emp_hrf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empirical_hrf.html">gen_empirical_hrf</a></span><span class="op">(</span><span class="va">sim_times</span>, <span class="va">sim_profile_norm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">emp_hrf</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (v) </span></span>
<span><span class="co">#&gt; .approxfun(x, y, v, method, yleft, yright, f, na.rm)</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1ab62afd0&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1ab27fea0&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "empirical_hrf"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span></span>
<span><span class="co"># Evaluate and plot (using a finer time grid for interpolation)</span></span>
<span><span class="va">fine_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">resp_emp</span> <span class="op">&lt;-</span> <span class="fu">emp_hrf</span><span class="op">(</span><span class="va">fine_times</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the interpolated curve with the original points</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fine_times</span>, <span class="va">resp_emp</span>, type <span class="op">=</span> <span class="st">'l'</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"BOLD Response"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Empirical HRF from Simulated Average Profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sim_times</span>, <span class="va">sim_profile_norm</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># Show original points</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/empirical_hrf_single-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="empirical-basis-set-via-pca">Empirical Basis Set via PCA<a class="anchor" aria-label="anchor" href="#empirical-basis-set-via-pca"></a>
</h3>
<p>You can create an empirical <em>basis set</em> by applying
dimensionality reduction (like PCA) to a collection of observed or
simulated HRFs.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Simulate a matrix of diverse HRFs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co"># for reproducibility</span></span>
<span><span class="va">n_sim</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">sim_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_sim</span>, <span class="op">{</span></span>
<span>  <span class="va">hrf_func</span> <span class="op">&lt;-</span> <span class="va">HRF_SPMG1</span> <span class="op">%&gt;%</span></span>
<span>              <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>              <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">hrf_func</span><span class="op">(</span><span class="va">sim_times</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show a sample of simulated HRFs to illustrate variability </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">sim_times</span>, <span class="va">sim_mat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">'l'</span>, col <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="fl">0.7</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Time (seconds)"</span>, ylab <span class="op">=</span> <span class="st">"Response"</span>, </span>
<span>        main <span class="op">=</span> <span class="st">"Sample of Simulated HRF Profiles"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/empirical_hrf_pca-1.png" width="672"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># 2. Perform PCA on the transpose (each column = one HRF, each row = one time point)</span></span>
<span><span class="va">pca_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">sim_mat</span><span class="op">)</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">n_components</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># Print variance explained by top components</span></span>
<span><span class="va">variance_explained</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">)</span><span class="op">$</span><span class="va">importance</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_components</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Variance explained by top"</span>, <span class="va">n_components</span>, <span class="st">"components:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">variance_explained</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Variance explained by top 3 components: 67.1% 29.9% 2.7%</span></span>
<span></span>
<span><span class="co"># Extract the top principal components</span></span>
<span><span class="va">pc_vectors</span> <span class="op">&lt;-</span> <span class="va">pca_res</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_components</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># 3. Convert principal components into HRF functions</span></span>
<span><span class="co"># Create list to store our empirical HRF functions</span></span>
<span><span class="va">list_pc_hrfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_components</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get the PC vector</span></span>
<span>  <span class="va">pc_vec</span> <span class="op">&lt;-</span> <span class="va">pc_vectors</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Start at 0 (shift so first value is 0)</span></span>
<span>  <span class="va">pc_vec_zeroed</span> <span class="op">&lt;-</span> <span class="va">pc_vec</span> <span class="op">-</span> <span class="va">pc_vec</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Normalize peak to 1 (or -1 if the peak is negative)</span></span>
<span>  <span class="va">max_abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">pc_vec_zeroed</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">pc_vec_norm</span> <span class="op">&lt;-</span> <span class="va">pc_vec_zeroed</span> <span class="op">/</span> <span class="va">max_abs</span></span>
<span>  </span>
<span>  <span class="co"># Create empirical HRF function</span></span>
<span>  <span class="va">list_pc_hrfs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empirical_hrf.html">gen_empirical_hrf</a></span><span class="op">(</span><span class="va">sim_times</span>, <span class="va">pc_vec_norm</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 4. Combine PC HRFs into a basis set using gen_hrf_set</span></span>
<span><span class="va">emp_pca_basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">gen_hrf_set</span>, <span class="va">list_pc_hrfs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">emp_pca_basis</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (t) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     do.call(cbind, lapply(xs, function(f) f(t)))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b1a8f32d18&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b1abb544d0&gt;</span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "HRF"      "function"</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "hrf_set"</span></span>
<span><span class="co">#&gt; attr(,"nbasis")</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; attr(,"span")</span></span>
<span><span class="co">#&gt; [1] 24</span></span>
<span><span class="co">#&gt; attr(,"params")</span></span>
<span><span class="co">#&gt; list()</span></span>
<span></span>
<span><span class="co"># 5. Evaluate and plot the basis functions</span></span>
<span><span class="va">resp_pca_basis</span> <span class="op">&lt;-</span> <span class="fu">emp_pca_basis</span><span class="op">(</span><span class="va">sim_times</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a prettier plot of the PCA basis functions</span></span>
<span><span class="va">pc_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">resp_pca_basis</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pc_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_components</span><span class="op">)</span></span>
<span><span class="va">pc_df</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="va">sim_times</span></span>
<span></span>
<span><span class="co"># Use ggplot for a nicer visualization</span></span>
<span><span class="va">pc_df_long</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">pc_df</span>, <span class="op">-</span><span class="va">Time</span>, names_to <span class="op">=</span> <span class="st">"Component"</span>, values_to <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pc_df_long</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Value</span>, color <span class="op">=</span> <span class="va">Component</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Empirical Basis Set from PCA"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"First "</span>, <span class="va">n_components</span>, <span class="st">" Principal Components"</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (seconds)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Component Value"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/empirical_hrf_pca-2.png" width="672"></p>
<p>This empirical basis set can then be used in regression models just
like any other pre-defined or custom basis set.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
