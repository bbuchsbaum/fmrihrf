<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hemodynamic Response Functions • fmrihrf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hemodynamic Response Functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmrihrf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a_01_hemodynamic_response.html">Hemodynamic Response Functions</a></li>
    <li><a class="dropdown-item" href="../articles/a_02_regressor.html">Building fMRI Regressors</a></li>
    <li><a class="dropdown-item" href="../articles/a_03_hrf_generators.html">HRF Generators</a></li>
    <li><a class="dropdown-item" href="../articles/a_04_advanced_modeling.html">Advanced HRF Modeling and Design</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmrihrf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hemodynamic Response Functions</h1>
                        <h4 data-toc-skip class="author">Bradley R.
Buchsbaum</h4>
            
            <h4 data-toc-skip class="date">2026-02-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmrihrf/blob/main/vignettes/a_01_hemodynamic_response.Rmd" class="external-link"><code>vignettes/a_01_hemodynamic_response.Rmd</code></a></small>
      <div class="d-none name"><code>a_01_hemodynamic_response.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-hemodynamic-response-functions-hrfs">Introduction to Hemodynamic Response Functions (HRFs)<a class="anchor" aria-label="anchor" href="#introduction-to-hemodynamic-response-functions-hrfs"></a>
</h2>
<p>A hemodynamic response function (HRF) models the temporal evolution
of the fMRI BOLD (Blood-Oxygen-Level-Dependent) signal in response to a
brief neural event. Typically, the BOLD signal peaks 4-6 seconds after
the event onset and then returns to baseline, often with a slight
undershoot.</p>
<p><code>fmrihrf</code> provides tools to define, manipulate, and
visualize various HRFs commonly used in fMRI analysis.</p>
</div>
<div class="section level2">
<h2 id="pre-defined-hrf-objects">Pre-defined HRF Objects<a class="anchor" aria-label="anchor" href="#pre-defined-hrf-objects"></a>
</h2>
<p><code>fmrihrf</code> includes several pre-defined HRF objects, which
are essentially functions with specific attributes defining their type,
number of basis functions (<code>nbasis</code>), and effective duration
(<code>span</code>).</p>
<p>Let’s look at two common examples: the SPM canonical HRF
(<code>HRF_SPMG1</code>) and a Gaussian HRF
(<code>HRF_GAUSSIAN</code>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SPM canonical HRF (based on difference of two gamma functions)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: SPMG1 --------------------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 1 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span>
<span><span class="co">#&gt;    Parameters: P1 = 5, P2 = 15, A1 = 0.0833</span></span>
<span></span>
<span><span class="co"># Gaussian HRF</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">HRF_GAUSSIAN</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: gaussian ------------------------------------------ </span></span>
<span><span class="co">#&gt;    Basis functions: 1 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span>
<span><span class="co">#&gt;    Parameters: mean = 6, sd = 2</span></span></code></pre></div>
<p>These objects are functions themselves, so you can evaluate them at
specific time points. The <code><a href="../reference/plot_hrfs.html">plot_hrfs()</a></code> function provides a
convenient way to compare multiple HRFs:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare HRFs using plot_hrfs() - normalize = TRUE scales to peak at 1.0</span></span>
<span><span class="fu"><a href="../reference/plot_hrfs.html">plot_hrfs</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, <span class="va">HRF_GAUSSIAN</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SPM Canonical"</span>, <span class="st">"Gaussian"</span><span class="op">)</span>,</span>
<span>          normalize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"Comparison of SPM Canonical and Gaussian HRFs"</span>,</span>
<span>          subtitle <span class="op">=</span> <span class="st">"HRFs normalized to peak at 1.0 for shape comparison"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/evaluate_basic_hrfs-1.png" class="r-plt" alt="" width="672"></p>
<p>Note that the <code>span</code> attribute (e.g., 24 seconds)
indicates the approximate time window over which the HRF is
non-zero.</p>
</div>
<div class="section level2">
<h2 id="modifying-hrf-parameters-with-gen_hrf">Modifying HRF Parameters with <code>gen_hrf</code><a class="anchor" aria-label="anchor" href="#modifying-hrf-parameters-with-gen_hrf"></a>
</h2>
<p>The <code>gen_hrf</code> function is a flexible way to create new HRF
functions, often by modifying the parameters of existing ones.</p>
<p>For example, the <code>hrf_gaussian</code> function takes
<code>mean</code> and <code>sd</code> arguments. We can use
<code>gen_hrf</code> to create Gaussian HRFs with different peak times
(<code>mean</code>) and widths (<code>sd</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Gaussian HRFs with different parameters using gen_hrf</span></span>
<span><span class="co"># Note: hrf_gaussian is the underlying function, not the HRF object HRF_GAUSSIAN</span></span>
<span><span class="va">hrf_gauss_7_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gaussian</span>, mean <span class="op">=</span> <span class="fl">7</span>, sd <span class="op">=</span> <span class="fl">3</span>, name <span class="op">=</span> <span class="st">"Gaussian (Mean=7, SD=3)"</span><span class="op">)</span></span>
<span><span class="va">hrf_gauss_5_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gaussian</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"Gaussian (Mean=5, SD=2)"</span><span class="op">)</span></span>
<span><span class="va">hrf_gauss_4_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gaussian</span>, mean <span class="op">=</span> <span class="fl">4</span>, sd <span class="op">=</span> <span class="fl">1</span>, name <span class="op">=</span> <span class="st">"Gaussian (Mean=4, SD=1)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/modify_gaussian_params_plot-1.png" class="r-plt" alt="" width="672"></p>
<p><code>gen_hrf</code> can also directly incorporate lags and durations
(see later sections).</p>
</div>
<div class="section level2">
<h2 id="modeling-event-duration-with-block_hrf">Modeling Event Duration with <code>block_hrf</code><a class="anchor" aria-label="anchor" href="#modeling-event-duration-with-block_hrf"></a>
</h2>
<p>fMRI events often have a duration (e.g., a stimulus presented for
several seconds). The <code>block_hrf</code> function (or
<code>gen_hrf</code> with a <code>width</code> argument) modifies an HRF
to model the response to a sustained event of a specific
<code>width</code> (duration). Internally, it convolves the original HRF
with a boxcar function of the specified width.</p>
<p>The <code>precision</code> argument controls the sampling resolution
used for this convolution.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create blocked HRFs using the SPM canonical HRF with different durations</span></span>
<span><span class="va">hrf_spm_w1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/blocked_hrfs_plot-1.png" class="r-plt" alt="" width="672"></p>
<div class="section level3">
<h3 id="normalization">Normalization<a class="anchor" aria-label="anchor" href="#normalization"></a>
</h3>
<p>By default, longer durations lead to higher peak responses (assuming
summation, see next section). Setting <code>normalize=TRUE</code> in
<code>block_hrf</code> (or <code>gen_hrf</code>) rescales the response
so the peak amplitude is approximately 1, regardless of duration.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create normalized blocked HRFs</span></span>
<span><span class="va">hrf_spm_w1_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">1</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w2_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">2</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w4_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">4</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/blocked_normalized_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="modeling-saturation-with-summate">Modeling Saturation with <code>summate</code><a class="anchor" aria-label="anchor" href="#modeling-saturation-with-summate"></a>
</h3>
<p>The <code>summate</code> argument in <code>block_hrf</code> controls
whether the response accumulates over the duration
(<code>summate=TRUE</code>, default) or saturates
(<code>summate=FALSE</code>). Saturation implies that the response
reaches a plateau and doesn’t increase further with longer
stimulation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create non-summating blocked HRFs</span></span>
<span><span class="va">hrf_spm_w2_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">2</span>, summate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w4_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">4</span>, summate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w8_nosum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">8</span>, summate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/blocked_summate_false_plot-1.png" class="r-plt" alt="" width="672"></p>
<p>We can combine <code>summate=FALSE</code> and
<code>normalize=TRUE</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create normalized, non-summating blocked HRFs</span></span>
<span><span class="va">hrf_spm_w2_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">2</span>, summate <span class="op">=</span> <span class="cn">FALSE</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w4_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">4</span>, summate <span class="op">=</span> <span class="cn">FALSE</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_spm_w8_nosum_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span><span class="va">HRF_SPMG1</span>, width <span class="op">=</span> <span class="fl">8</span>, summate <span class="op">=</span> <span class="cn">FALSE</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/blocked_summate_false_norm_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="modeling-temporal-shifts-with-lag_hrf">Modeling Temporal Shifts with <code>lag_hrf</code><a class="anchor" aria-label="anchor" href="#modeling-temporal-shifts-with-lag_hrf"></a>
</h2>
<p>Sometimes, the hemodynamic response might be delayed or advanced
relative to the event onset. The <code>lag_hrf</code> function (or
<code>gen_hrf_lagged</code>) shifts an existing HRF in time by a
specified <code>lag</code> (in seconds). A positive lag delays the
response, while a negative lag advances it.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create lagged versions of the Gaussian HRF</span></span>
<span><span class="va">hrf_gauss_lag_neg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="va">HRF_GAUSSIAN</span>, lag <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">hrf_gauss_lag_0</span> <span class="op">&lt;-</span> <span class="va">HRF_GAUSSIAN</span> <span class="co"># Original (lag=0)</span></span>
<span><span class="va">hrf_gauss_lag_pos3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="va">HRF_GAUSSIAN</span>, lag <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/lagged_hrfs_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level2">
<h2 id="combining-lag-and-duration">Combining Lag and Duration<a class="anchor" aria-label="anchor" href="#combining-lag-and-duration"></a>
</h2>
<p>We can combine <code>lag_hrf</code> and <code>block_hrf</code> using
the pipe operator (<code>%&gt;%</code>) from <code>dplyr</code> (or
<code>magrittr</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create HRFs that are both lagged and blocked</span></span>
<span><span class="va">hrf_lb_1</span> <span class="op">&lt;-</span> <span class="va">HRF_GAUSSIAN</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_lb_3</span> <span class="op">&lt;-</span> <span class="va">HRF_GAUSSIAN</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">3</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hrf_lb_5</span> <span class="op">&lt;-</span> <span class="va">HRF_GAUSSIAN</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">5</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/lagged_blocked_hrfs_plot-1.png" class="r-plt" alt="" width="672"></p>
<p>Alternatively, <code>gen_hrf</code> can apply lag and width
directly:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using gen_hrf directly</span></span>
<span><span class="va">hrf_lb_gen_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gaussian</span>, lag <span class="op">=</span> <span class="fl">3</span>, width <span class="op">=</span> <span class="fl">3</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">resp_lb_gen_3</span> <span class="op">&lt;-</span> <span class="fu">hrf_lb_gen_3</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare (should be very similar to hrf_lb_3 from piped version)</span></span>
<span><span class="co"># plot(time_points, resp_lb_3, type = 'l', col = 2, lwd = 2, main = "Piped vs gen_hrf")</span></span>
<span><span class="co"># lines(time_points, resp_lb_gen_3, col = 1, lty = 2, lwd = 2)</span></span>
<span><span class="co"># legend("topright", legend = c("Piped", "gen_hrf"), col = c(2, 1), lty = c(1, 2), lwd = 2)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multivariate-hrfs-basis-sets">Multivariate HRFs: Basis Sets<a class="anchor" aria-label="anchor" href="#multivariate-hrfs-basis-sets"></a>
</h2>
<p>Instead of assuming a fixed HRF shape, we can model the response
using a linear combination of multiple basis functions. This allows for
more flexibility in capturing variations in HRF shape across brain
regions or individuals. The resulting HRF function returns a matrix
where each column corresponds to a basis function.</p>
<div class="section level3">
<h3 id="spm-basis-sets">SPM Basis Sets<a class="anchor" aria-label="anchor" href="#spm-basis-sets"></a>
</h3>
<p><code>fmrihrf</code> provides pre-defined HRF objects for the SPM
canonical HRF plus its temporal derivative (<code>HRF_SPMG2</code>), and
additionally its dispersion derivative (<code>HRF_SPMG3</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SPM + Temporal Derivative (2 basis functions)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">HRF_SPMG2</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: SPMG2 --------------------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 2 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span>
<span></span>
<span><span class="co"># SPM + Temporal + Dispersion Derivatives (3 basis functions)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">HRF_SPMG3</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: SPMG3 --------------------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 3 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/spm_basis_sets_plot-1.png" class="r-plt" alt="" width="672"></p>
<p><img src="a_01_hemodynamic_response_files/figure-html/spm_basis_sets_plot2-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="b-spline-basis-set">B-Spline Basis Set<a class="anchor" aria-label="anchor" href="#b-spline-basis-set"></a>
</h3>
<p>The <code>hrf_bspline</code> function generates a B-spline basis set.
We typically use it within <code>gen_hrf</code> to create an HRF object.
Key parameters are <code>N</code> (number of basis functions) and
<code>degree</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># B-spline basis with N=5 basis functions, degree=3 (cubic)</span></span>
<span><span class="va">hrf_bs_5_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_bspline</span>, N <span class="op">=</span> <span class="fl">5</span>, degree <span class="op">=</span> <span class="fl">3</span>, name <span class="op">=</span> <span class="st">"B-spline (N=5, deg=3)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_bs_5_3</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: B-spline (N=5, deg=3) ----------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 5 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span>
<span></span>
<span><span class="co"># B-spline basis with N=10 basis functions, degree=1 (linear -&gt; tent functions)</span></span>
<span><span class="va">hrf_bs_10_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_bspline</span>, N <span class="op">=</span> <span class="fl">10</span>, degree <span class="op">=</span> <span class="fl">1</span>, name <span class="op">=</span> <span class="st">"Tent Set (N=10)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_bs_10_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: Tent Set (N=10) ----------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 10 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/bspline_basis_plot-1.png" class="r-plt" alt="" width="672"></p>
<p><img src="a_01_hemodynamic_response_files/figure-html/tent_basis_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="sine-basis-set">Sine Basis Set<a class="anchor" aria-label="anchor" href="#sine-basis-set"></a>
</h3>
<p>The <code>hrf_sine</code> function creates a basis set using sine
waves of different frequencies.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrf_sin_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_sine</span>, N <span class="op">=</span> <span class="fl">5</span>, name <span class="op">=</span> <span class="st">"Sine Basis (N=5)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_sin_5</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: Sine Basis (N=5) ---------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 5 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/sine_basis_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="half-cosine-basis-set-flobs-like">Half-Cosine Basis Set (FLOBS-like)<a class="anchor" aria-label="anchor" href="#half-cosine-basis-set-flobs-like"></a>
</h3>
<p>The <code>hrf_half_cosine</code> function implements the basis set
described by Woolrich et al. (2004), often used in FSL’s FLOBS (FMRIB’s
Linear Optimal Basis Sets). It uses four half-cosine functions to model
initial dip, rise, fall/undershoot, and recovery.</p>
<p><img src="a_01_hemodynamic_response_files/figure-html/half_cosine-1.png" class="r-plt" alt="" width="672"></p>
<!-- ### Daguerre Polynomial Basis Set

Daguerre polynomials provide an orthogonal basis set on [0, ∞) suitable for modeling decaying responses. This functionality is not yet implemented in the package.


```` r
# Future implementation:
# hrf_dag_3 <- HRF_DAGUERRE_BASIS(n_basis = 3)
# print(hrf_dag_3)
# resp_dag_3 <- hrf_dag_3(time_points)
# matplot(time_points, resp_dag_3, type = 'l', lty = 1, lwd = 1.5,
#         xlab = "Time (seconds)", ylab = "BOLD Response",
#         main = "Daguerre Basis Set (N=3)")
``` -->
</div>
</div>
<div class="section level2">
<h2 id="other-hrf-shapes">Other HRF Shapes<a class="anchor" aria-label="anchor" href="#other-hrf-shapes"></a>
</h2>
<div class="section level3">
<h3 id="gamma-hrf">Gamma HRF<a class="anchor" aria-label="anchor" href="#gamma-hrf"></a>
</h3>
<p>The <code>hrf_gamma</code> function uses the gamma probability
density function.</p>
<p>````</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrf_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_gamma</span>, shape <span class="op">=</span> <span class="fl">6</span>, rate <span class="op">=</span> <span class="fl">1</span>, name <span class="op">=</span> <span class="st">"Gamma (shape=6, rate=1)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_gam</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: Gamma (shape=6, rate=1) --------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 1 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/gamma_hrf_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="mexican-hat-wavelet-hrf">Mexican Hat Wavelet HRF<a class="anchor" aria-label="anchor" href="#mexican-hat-wavelet-hrf"></a>
</h3>
<p>The <code>hrf_mexhat</code> function uses the Mexican hat wavelet
(second derivative of a Gaussian).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrf_mh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_mexhat</span>, mean <span class="op">=</span> <span class="fl">6</span>, sd <span class="op">=</span> <span class="fl">1.5</span>, name <span class="op">=</span> <span class="st">"Mexican Hat (mean=6, sd=1.5)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_mh</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: Mexican Hat (mean=6, sd=1.5) ---------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 1 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/mexhat_hrf_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="inverse-logit-difference-hrf">Inverse Logit Difference HRF<a class="anchor" aria-label="anchor" href="#inverse-logit-difference-hrf"></a>
</h3>
<p>The <code>hrf_inv_logit</code> function creates an HRF shape by
subtracting two inverse logit (sigmoid) functions, allowing control over
rise and fall times.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrf_il</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_hrf.html">gen_hrf</a></span><span class="op">(</span><span class="va">hrf_inv_logit</span>, mu1 <span class="op">=</span> <span class="fl">5</span>, s1 <span class="op">=</span> <span class="fl">1</span>, mu2 <span class="op">=</span> <span class="fl">15</span>, s2 <span class="op">=</span> <span class="fl">1.5</span>, name <span class="op">=</span> <span class="st">"Inv. Logit Diff."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_il</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: Inv. Logit Diff. ---------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 1 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/inv_logit_hrf_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="boxcar-and-weighted-hrfs-no-hemodynamic-delay">Boxcar and Weighted HRFs (No Hemodynamic Delay)<a class="anchor" aria-label="anchor" href="#boxcar-and-weighted-hrfs-no-hemodynamic-delay"></a>
</h2>
<p>Traditional HRFs model the hemodynamic delay—the sluggish blood flow
response that peaks several seconds after neural activity. However,
sometimes you want to extract signal from specific time windows
<em>without</em> assuming any hemodynamic transformation. This is useful
for: - Extracting raw signal averages from specific post-stimulus
windows - Trial-wise analyses where you want the mean (or weighted mean)
of the BOLD signal - Comparing signal in different temporal windows
directly - Creating custom temporal weighting schemes</p>
<div class="section level3">
<h3 id="simple-boxcar-hrf-hrf_boxcar">Simple Boxcar HRF (<code>hrf_boxcar</code>)<a class="anchor" aria-label="anchor" href="#simple-boxcar-hrf-hrf_boxcar"></a>
</h3>
<p>The <code>hrf_boxcar</code> function creates a simple step function
that is constant within a time window and zero outside. Unlike
traditional HRFs, there is no built-in hemodynamic delay—the HRF starts
at time 0 (event onset) and extends for the specified
<code>width</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a boxcar of width 5 seconds (from 0 to 5 seconds)</span></span>
<span><span class="va">hrf_box</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_boxcar.html">hrf_boxcar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_box</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: boxcar[5] ----------------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 1 </span></span>
<span><span class="co">#&gt;    Span: 5 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/boxcar_basic_plot-1.png" class="r-plt" alt="" width="672"></p>
<p>To create a boxcar that starts at a later time point—useful for
capturing signal in a specific post-stimulus window—use
<code><a href="../reference/lag_hrf.html">lag_hrf()</a></code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Boxcar from 4-8 seconds post-stimulus (capturing the expected BOLD peak)</span></span>
<span><span class="co"># Use lag_hrf() to delay a 4-second boxcar by 4 seconds</span></span>
<span><span class="va">hrf_delayed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_boxcar.html">hrf_boxcar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/boxcar_delayed_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="normalized-boxcar-estimating-mean-signal">Normalized Boxcar: Estimating Mean Signal<a class="anchor" aria-label="anchor" href="#normalized-boxcar-estimating-mean-signal"></a>
</h3>
<p>When <code>normalize = TRUE</code>, the boxcar is scaled so its
integral equals 1. This has an important interpretation: <strong>when
used in a GLM, the regression coefficient β directly estimates the mean
signal within the time window</strong>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Normalized boxcar - integral = 1</span></span>
<span><span class="co"># A 4-second boxcar lagged by 4 seconds (captures 4-8s window)</span></span>
<span><span class="va">hrf_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_boxcar.html">hrf_boxcar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check: amplitude should be 1/4 = 0.25</span></span>
<span><span class="va">t_fine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">resp_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">hrf_norm</span>, <span class="va">t_fine</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Amplitude of normalized boxcar:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">resp_norm</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Amplitude of normalized boxcar: 0.25</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Expected (1/width):"</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Expected (1/width): 0.25</span></span>
<span></span>
<span><span class="co"># Verify integral ≈ 1</span></span>
<span><span class="va">integral</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">resp_norm</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Integral of normalized boxcar:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">integral</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Integral of normalized boxcar: 1</span></span></code></pre></div>
<p><strong>Interpretation</strong>: If you fit a GLM with this
normalized boxcar HRF, the estimated β coefficient represents the
average BOLD signal from 4-8 seconds post-stimulus.</p>
</div>
<div class="section level3">
<h3 id="weighted-hrf-hrf_weighted">Weighted HRF (<code>hrf_weighted</code>)<a class="anchor" aria-label="anchor" href="#weighted-hrf-hrf_weighted"></a>
</h3>
<p>The <code>hrf_weighted</code> function provides more flexibility by
allowing you to specify different weights at different time points. You
can either: - Use <code>width</code> + <code>weights</code>: evenly
space the weights across the specified width - Use <code>times</code> +
<code>weights</code>: explicitly specify the time points for each
weight</p>
<p>This creates either a step function
(<code>method = "constant"</code>) or a smoothly interpolated function
(<code>method = "linear"</code>).</p>
<div class="section level4">
<h4 id="using-width-for-evenly-spaced-weights">Using <code>width</code> for Evenly Spaced Weights<a class="anchor" aria-label="anchor" href="#using-width-for-evenly-spaced-weights"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 6 weights evenly spaced over 10 seconds (at 0, 2, 4, 6, 8, 10)</span></span>
<span><span class="va">hrf_wt_width</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_weighted.html">hrf_weighted</a></span><span class="op">(</span></span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"constant"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/weighted_width_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level4">
<h4 id="using-explicit-times-for-custom-spacing">Using Explicit <code>times</code> for Custom Spacing<a class="anchor" aria-label="anchor" href="#using-explicit-times-for-custom-spacing"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Weighted step function with explicit time points</span></span>
<span><span class="va">hrf_wt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_weighted.html">hrf_weighted</a></span><span class="op">(</span></span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"constant"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/weighted_times_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level4">
<h4 id="smooth-weights-linear-interpolation">Smooth Weights (Linear Interpolation)<a class="anchor" aria-label="anchor" href="#smooth-weights-linear-interpolation"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Smooth weights using linear interpolation</span></span>
<span><span class="va">hrf_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_weighted.html">hrf_weighted</a></span><span class="op">(</span></span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">0.3</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"linear"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/weighted_linear_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level4">
<h4 id="sub-second-precision">Sub-second Precision<a class="anchor" aria-label="anchor" href="#sub-second-precision"></a>
</h4>
<p>The <code>hrf_weighted</code> function supports sub-second time
intervals, which is useful for fine-grained temporal weighting:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sub-second intervals: create a Gaussian-shaped weight function</span></span>
<span><span class="va">times_fine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">10</span>, by <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">weights_gaussian</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">times_fine</span>, mean <span class="op">=</span> <span class="fl">7</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hrf_gauss_wt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_weighted.html">hrf_weighted</a></span><span class="op">(</span><span class="va">weights_gaussian</span>, times <span class="op">=</span> <span class="va">times_fine</span>, method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/weighted_subsecond_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="normalized-weighted-hrf-estimating-weighted-mean">Normalized Weighted HRF: Estimating Weighted Mean<a class="anchor" aria-label="anchor" href="#normalized-weighted-hrf-estimating-weighted-mean"></a>
</h3>
<p>When <code>normalize = TRUE</code>, the weights are scaled to sum
(constant) or integrate (linear) to 1. The regression coefficient then
estimates a <strong>weighted mean</strong> of the signal:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Normalized weights - creates weighted average interpretation</span></span>
<span><span class="va">hrf_wt_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_weighted.html">hrf_weighted</a></span><span class="op">(</span></span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Will be normalized</span></span>
<span>  times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"constant"</span>,</span>
<span>  normalize <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The coefficient β will estimate: (1*Y[4-6] + 2*Y[6-8] + 2*Y[8-10] + 1*Y[10+]) / 6</span></span>
<span><span class="co"># where Y[a-b] is the signal in that interval</span></span>
<span></span>
<span><span class="va">t_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">resp_wt_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">hrf_wt_norm</span>, <span class="va">t_check</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify: integral should be approximately 1</span></span>
<span><span class="va">integral_wt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">resp_wt_norm</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Integral of normalized weighted HRF:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">integral_wt</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Integral of normalized weighted HRF: 2.002</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="practical-example-comparing-early-vs--late-response-windows">Practical Example: Comparing Early vs. Late Response Windows<a class="anchor" aria-label="anchor" href="#practical-example-comparing-early-vs--late-response-windows"></a>
</h3>
<p>A common analysis compares BOLD signal in early vs. late portions of
a trial. Here’s how to set up HRFs for this:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Early window: 2-6 seconds (4-second boxcar lagged by 2 seconds)</span></span>
<span><span class="va">hrf_early</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_boxcar.html">hrf_boxcar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Late window: 8-12 seconds (4-second boxcar lagged by 8 seconds)</span></span>
<span><span class="va">hrf_late</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hrf_boxcar.html">hrf_boxcar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/early_late_comparison_plot-1.png" class="r-plt" alt="" width="672"></p>
<p>Using these HRFs in separate regressors allows you to estimate and
compare the mean BOLD signal in each window.</p>
</div>
<div class="section level3">
<h3 id="using-boxcarweighted-hrfs-with-regressors">Using Boxcar/Weighted HRFs with Regressors<a class="anchor" aria-label="anchor" href="#using-boxcarweighted-hrfs-with-regressors"></a>
</h3>
<p>These HRFs integrate seamlessly with the <code><a href="../reference/regressor.html">regressor()</a></code>
function:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a regressor with boxcar HRF (4-second window starting 4s after onset)</span></span>
<span><span class="va">reg_boxcar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regressor.html">regressor</a></span><span class="op">(</span></span>
<span>  onsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  hrf <span class="op">=</span> <span class="fu"><a href="../reference/hrf_boxcar.html">hrf_boxcar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare with traditional SPM HRF</span></span>
<span><span class="va">reg_spm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regressor.html">regressor</a></span><span class="op">(</span>onsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>, hrf <span class="op">=</span> <span class="va">HRF_SPMG1</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/boxcar_regressor_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="creating-custom-basis-sets-with-gen_hrf_set">Creating Custom Basis Sets with <code>gen_hrf_set</code><a class="anchor" aria-label="anchor" href="#creating-custom-basis-sets-with-gen_hrf_set"></a>
</h2>
<p>The <code>gen_hrf_set</code> function allows you to combine
<em>any</em> set of HRF functions into a single multivariate HRF object
(a basis set).</p>
<p>For example, we can create a basis set from a series of lagged
Gaussian HRFs:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a list of lagged Gaussian HRFs</span></span>
<span><span class="va">lag_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">list_of_hrfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lag_times</span>, <span class="kw">function</span><span class="op">(</span><span class="va">lag</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span><span class="va">HRF_GAUSSIAN</span>, lag <span class="op">=</span> <span class="va">lag</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine them into a single HRF basis set object</span></span>
<span><span class="va">hrf_custom_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">gen_hrf_set</span>, <span class="va">list_of_hrfs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hrf_custom_set</span><span class="op">)</span> <span class="co"># Note: name is default 'hrf_set', nbasis is 6</span></span>
<span><span class="co">#&gt; -- HRF: hrf_set ------------------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 6 </span></span>
<span><span class="co">#&gt;    Span: 34 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/custom_basis_lagged_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level2">
<h2 id="creating-empirical-hrfs">Creating Empirical HRFs<a class="anchor" aria-label="anchor" href="#creating-empirical-hrfs"></a>
</h2>
<div class="section level3">
<h3 id="from-a-single-measured-response-gen_empirical_hrf">From a Single Measured Response
(<code>gen_empirical_hrf</code>)<a class="anchor" aria-label="anchor" href="#from-a-single-measured-response-gen_empirical_hrf"></a>
</h3>
<p>If you have a measured or estimated hemodynamic response profile
(e.g., from deconvolution), you can turn it into an HRF function using
<code>gen_empirical_hrf</code>. It uses linear interpolation between the
provided points.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate an average measured response profile</span></span>
<span><span class="va">sim_times</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">24</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co"># For reproducibility</span></span>
<span><span class="va">sim_profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">20</span>, <span class="op">{</span></span>
<span>  <span class="va">h</span> <span class="op">&lt;-</span> <span class="va">HRF_SPMG1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                    <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">h</span><span class="op">(</span><span class="va">sim_times</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Normalize profile to max = 1 for better visualization</span></span>
<span><span class="va">sim_profile_norm</span> <span class="op">&lt;-</span> <span class="va">sim_profile</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sim_profile</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the empirical HRF function from the normalized profile</span></span>
<span><span class="va">emp_hrf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empirical_hrf.html">gen_empirical_hrf</a></span><span class="op">(</span><span class="va">sim_times</span>, <span class="va">sim_profile_norm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">emp_hrf</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: empirical_hrf ------------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 1 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/empirical_hrf_single_plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="empirical-basis-set-via-pca">Empirical Basis Set via PCA<a class="anchor" aria-label="anchor" href="#empirical-basis-set-via-pca"></a>
</h3>
<p>You can create an empirical <em>basis set</em> by applying
dimensionality reduction (like PCA) to a collection of observed or
simulated HRFs.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Simulate a matrix of diverse HRFs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co"># for reproducibility</span></span>
<span><span class="va">n_sim</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">sim_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_sim</span>, <span class="op">{</span></span>
<span>  <span class="va">hrf_func</span> <span class="op">&lt;-</span> <span class="va">HRF_SPMG1</span> <span class="op">%&gt;%</span></span>
<span>              <span class="fu"><a href="../reference/lag_hrf.html">lag_hrf</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>              <span class="fu"><a href="../reference/block_hrf.html">block_hrf</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">hrf_func</span><span class="op">(</span><span class="va">sim_times</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/empirical_hrf_pca_plot1-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2. Perform PCA on the transpose (each column = one HRF, each row = one time point)</span></span>
<span><span class="va">pca_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">sim_mat</span><span class="op">)</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">n_components</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># Print variance explained by top components</span></span>
<span><span class="va">variance_explained</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">)</span><span class="op">$</span><span class="va">importance</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_components</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Variance explained by top"</span>, <span class="va">n_components</span>, <span class="st">"components:"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">variance_explained</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Variance explained by top 3 components: 67.1% 29.9% 2.7%</span></span>
<span></span>
<span><span class="co"># Extract the top principal components</span></span>
<span><span class="va">pc_vectors</span> <span class="op">&lt;-</span> <span class="va">pca_res</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_components</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># 3. Convert principal components into HRF functions</span></span>
<span><span class="va">list_pc_hrfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_components</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pc_vec</span> <span class="op">&lt;-</span> <span class="va">pc_vectors</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">pc_vec_zeroed</span> <span class="op">&lt;-</span> <span class="va">pc_vec</span> <span class="op">-</span> <span class="va">pc_vec</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">max_abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">pc_vec_zeroed</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">pc_vec_norm</span> <span class="op">&lt;-</span> <span class="va">pc_vec_zeroed</span> <span class="op">/</span> <span class="va">max_abs</span></span>
<span>  <span class="va">list_pc_hrfs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empirical_hrf.html">gen_empirical_hrf</a></span><span class="op">(</span><span class="va">sim_times</span>, <span class="va">pc_vec_norm</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 4. Combine PC HRFs into a basis set using gen_hrf_set</span></span>
<span><span class="va">emp_pca_basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">gen_hrf_set</span>, <span class="va">list_pc_hrfs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">emp_pca_basis</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- HRF: hrf_set ------------------------------------------- </span></span>
<span><span class="co">#&gt;    Basis functions: 3 </span></span>
<span><span class="co">#&gt;    Span: 24 s</span></span></code></pre></div>
<p><img src="a_01_hemodynamic_response_files/figure-html/empirical_hrf_pca_plot2-1.png" class="r-plt" alt="" width="672"></p>
<p>This empirical basis set can then be used in regression models just
like any other pre-defined or custom basis set.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
